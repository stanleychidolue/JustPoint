<!DOCTYPE html>
<html lang="en">
{% load static %} {% load custom_tag %}

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{%block title%}Delivery Completed{%endblock title%}</title>
    <!-- ScrollReveal  -->
    <script src="https://unpkg.com/scrollreveal@4.0.0/dist/scrollreveal.min.js"></script>

    <!-- <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Quicksand:wght@300..700&display=swap"
    rel="stylesheet" /> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" />
    <!-- custom favicon link  -->
    <link rel="icon" href="{%static 'images/base/JustPoint-favicon.ico' %}" />
</head>

<body>
    <section style="margin-top: 5%;">
        <div class="row justify-content-center">
            <div class=" col-lg-8 col-md-10 col-12 ">

                <div class="ms-md-0 ms-2">
                    <div class=" mb-sm-5 mb-4 payment-options-heading d-flex justify-content-cente">
                        <div style="background-color: var(--color-primary); " class="d-inline">
                            <img class="nav-logo" src="{%static 'images/base/JustPoint-logo.svg' %}" alt="Logo" />
                        </div>
                        <span class="ms-1 payment-options-title ">JustPoint Delivery Pickup</span>
                    </div>




                    <div class="additional-info ms-3 mt-3">
                        <h6 style="color: var(--color-primary); font-weight: bolder;" class="mb-0">Note:</h6>
                        <ul style="font-size: 12px;">
                            <li>
                                Ensure to <span><input style="pointer-events: none; cursor: none;"
                                        class="form-check-input" type="checkbox" checked>mark</span> only
                                items you have received and verified
                            </li>
                            <li>
                                Click on the <span class="info-highlight">I have received these items</span> button
                                after all items have been received and confirmed.
                            </li>
                            <li>
                                Estimated time of delivery is 10mins, so endevour to complete your delivery within the
                                said time.
                            </li>

                            <!-- <li>
                                Be sure to click the delivery complete button only after the customer has received the
                                complete order.
                            </li> -->
                        </ul>
                    </div>
                </div>
                <hr>

                <div class="order-heading order-details item-font">
                    <span> Product Name</span> <span>Product Price</span> <span class="text-center">Product Qty</span>
                    <span class="text-center"> Received<i class="bi bi-check-all"></i></span>
                </div>
                <form action="" method="post" id="checkForm">
                    {% csrf_token %}
                    <ol class="px-sm-4 px-md-5 px-2 mb-5">
                        {%for item in shop_items%}
                        <div class="order-details  item-font">
                            <li>
                                <span> {{item|get_product_property:"name"}}</span>
                            </li>
                            <span>{{item|get_product_property:"price"|currency}}</span>
                            <span class="text-center">{{item.quantity}}</span>
                            <span class="text-center"><input class="form-check-input itemCheckInput" type="checkbox"
                                    name="{{ forloop.counter }}" id="" value="{{item.pk}}"></span>
                        </div>
                        {%endfor%}
                    </ol>


                    <div style="background-color: grey; width: 320px; justify-self: center; justify-items: center;"
                        class="popUpContainer" hidden>
                        <p style="color: var(--color-primar);" class="text-center">I could not get all the items from
                            this shop</p>
                        <a href=""><button class="mb-2 justify-self-center">Check Other Stores </button></a>
                    </div>
                    <div class="d-flex justify-content-center mb-3 mt-1 ">
                        <button style="background-color: var(--color-green);width: auto;" type="submit"
                            class=" login-button disabled2 receivedItemsBtn">
                            I Have Received These Items
                        </button>
                    </div>
                </form>
    </section>
</body>


<script>

    var checkInputs = document.querySelectorAll(".itemCheckInput");
    checkInputs.forEach(element => {
        element.addEventListener("change", (e) => {
            let newCheckInputs = document.querySelectorAll(".itemCheckInput");
            let checkedBtns = []
            newCheckInputs.forEach(e => {
                if (e.checked) {
                    checkedBtns.push("checked")
                } else { checkedBtns.push("not checked") }
            });
            if (!checkedBtns.includes("not checked")) {
                let receivedItemsBtn = document.querySelector(".receivedItemsBtn");
                receivedItemsBtn.classList.remove("disabled2");
            }
        })
    });



    var popUpContainer = document.querySelector(".popUpContainer");
    var receivedItemsBtn = document.querySelector(".receivedItemsBtn");

    receivedItemsBtn.addEventListener("click", (event) => {
        event.preventDefault();
        let checkInputs = document.querySelectorAll(".itemCheckInput");
        let form = document.querySelector("#checkForm")
        let checkedBtns = []
        checkInputs.forEach(e => {
            if (e.checked) {
                checkedBtns.push("checked")
            } else { checkedBtns.push("not checked") }
        });
        console.log(checkedBtns)
        if (checkedBtns.includes("not checked")) {
            popUpContainer.removeAttribute("hidden");
        } else {
            form.submit();
        }
    })




</script>

</html>